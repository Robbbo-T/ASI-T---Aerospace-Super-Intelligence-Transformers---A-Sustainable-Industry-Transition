{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Top Final Algorithm (TFA) Spec",
  "type": "object",
  "required": ["D", "L", "T", "A", "E", "X", "I", "R", "V", "M", "Phi"],
  "properties": {
    "D": { "type": "array", "items": {"type": "string"}, "description": "Dominios" },
    "L": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1,
      "description": "Capas TFA en orden jerárquico (coarse→fine)",
      "examples": [["SYSTEMS","STATIONS","COMPONENTS","BITS","QUBITS","ELEMENTS","WAVES","STATES"]]
    },
    "T": {
      "type": "array",
      "items": {
        "type": "array",
        "prefixItems": [
          {"type": "string", "description": "Dominio ∈ D"},
          {"type": "string", "description": "Capa ∈ L"}
        ],
        "minItems": 2,
        "maxItems": 2
      },
      "description": "Nodos jerárquicos T ⊆ D×L"
    },
    "A": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["mu", "tau", "lambda"],
        "properties": {
          "mu": {"type": "string", "description": "UTCS–MI id"},
          "tau": {
            "type": "string",
            "description": "Tipo (README,SPEC,CODE,TEST,CONTRACT,CAD,DATA,MODEL,NOTE)",
            "enum": ["README","SPEC","CODE","TEST","CONTRACT","CAD","DATA","MODEL","NOTE"]
          },
          "lambda": {
            "type": "array",
            "prefixItems": [{"type": "string"}, {"type": "string"}],
            "minItems": 2,
            "maxItems": 2,
            "description": "Ubicación (d,l) ∈ T"
          },
          "content_score": { "type": "integer", "minimum": 0, "maximum": 2, "default": 0 },
          "root": {"type": "boolean", "default": false}
        },
        "additionalProperties": false
      },
      "description": "Artefactos"
    },
    "E": {
      "type": "array",
      "items": {
        "type": "array",
        "prefixItems": [{"type": "string"}, {"type": "string"}],
        "minItems": 2,
        "maxItems": 2
      },
      "description": "Aristas estructurales (b→a) sobre ids μ"
    },
    "X": {
      "type": "array",
      "items": {
        "type": "array",
        "prefixItems": [{"type": "string"}, {"type": "string"}],
        "minItems": 2,
        "maxItems": 2
      },
      "description": "Aristas de threading (direccionales; duplicar para ↔)"
    },
    "need_readme_nodes": {
      "type": "array",
      "items": {
        "type": "array",
        "prefixItems": [{"type": "string"}, {"type": "string"}],
        "minItems": 2,
        "maxItems": 2
      },
      "description": "Nodos t que requieren README"
    },
    "I": {
      "type": "object",
      "required": ["language", "version"],
      "properties": {
        "language": {"type": "string", "const": "UTCS–MI"},
        "version": {"type": "string"},
        "grammar": {"type": "string"},
        "validator": {"type": "string"}
      }
    },
    "R": {
      "type": "object",
      "properties": {
        "no_orphan_unless_root": {"type": "boolean", "default": true},
        "min_crossref": {"type": "boolean", "default": true},
        "id_canonical": {"type": "boolean", "default": true},
        "strict_tfa_only": {"type": "boolean", "default": true},
        "quantum_layers_required": {"type": "array", "items": {"type": "string"}}
      },
      "additionalProperties": true
    },
    "V": {
      "type": "object",
      "properties": {
        "V1": {"type": "string"},
        "V2": {"type": "string"},
        "V3": {"type": "string"},
        "V4": {"type": "string"},
        "V5": {"type": "string"}
      },
      "additionalProperties": false
    },
    "M": { "type": "object", "description": "Semántica de trazabilidad", "additionalProperties": true },
    "Phi": {
      "type": "object",
      "required": ["alpha", "beta", "gamma", "delta", "epsilon"],
      "properties": {
        "alpha": {"type": "number", "exclusiveMinimum": 0},
        "beta": {"type": "number", "exclusiveMinimum": 0},
        "gamma": {"type": "number", "exclusiveMinimum": 0},
        "delta": {"type": "number", "exclusiveMinimum": 0},
        "epsilon": {"type": "number", "exclusiveMinimum": 0}
      }
    }
  },
  "additionalProperties": false
}
