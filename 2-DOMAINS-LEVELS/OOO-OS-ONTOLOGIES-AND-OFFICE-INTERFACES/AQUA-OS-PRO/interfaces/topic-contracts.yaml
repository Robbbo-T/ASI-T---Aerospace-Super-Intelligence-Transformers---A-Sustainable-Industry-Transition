# AQUA OS PRO Interface & Topic Contracts
# Domain Interface (DI) Specifications for Cross-Domain Integration

metadata:
  title: "AQUA OS PRO Topic Contracts"
  version: "1.0" 
  specification: "Domain Interface (DI) Layer"
  quantum_bridge_aware: true
  
# Topic Contract Definitions
topic_contracts:

  # Meteorological Data Ingestion
  "/met/tiles":
    description: "GRIB/NetCDF tiles + bias metadata, timestamps, signatures"
    schema_version: "v1.0"
    data_format: "GRIB2/NetCDF4"
    security: 
      signed: true
      replay_protected: true
    update_frequency: "5_minutes"
    retention: "24_hours"
    
    schema:
      fields:
        - name: "wind_u"
          type: "float32_array"
          units: "m/s"
          dimensions: [lat, lon, level, time]
        - name: "wind_v" 
          type: "float32_array"
          units: "m/s"
          dimensions: [lat, lon, level, time]
        - name: "temperature"
          type: "float32_array"
          units: "K"
          dimensions: [lat, lon, level, time]
        - name: "geopotential_height"
          type: "float32_array" 
          units: "m"
          dimensions: [lat, lon, level, time]
      
      metadata:
        - name: "forecast_time"
          type: "datetime"
          required: true
        - name: "model_run"
          type: "string"
          enum: ["ECMWF", "RAP", "HRRR", "GraphCast"]
        - name: "bias_correction_applied"
          type: "boolean"
        - name: "signature"
          type: "string"
          format: "eip712"

  # Sensor Data Streams  
  "/sensors/*":
    description: "Real-time sensor streams with quantum IMU integration"
    schema_version: "v1.0"
    real_time: true
    sampling_rate_hz: 100
    
    subtopics:
      "/sensors/gnss":
        schema:
          position: [latitude, longitude, altitude_msl]
          velocity: [velocity_north, velocity_east, velocity_down]
          accuracy: [horizontal_accuracy, vertical_accuracy]
          timestamp: "iso8601"
          
      "/sensors/ins":
        schema:
          attitude: [roll, pitch, yaw]  # degrees
          angular_velocity: [p, q, r]  # deg/s
          acceleration: [ax, ay, az]    # m/s²
          bias_estimates: [gyro_bias, accel_bias]
          
      "/sensors/quantum_imu":
        schema:
          reference_corrections: [delta_roll, delta_pitch, delta_yaw]
          stability_metrics: [allan_variance, bias_drift]
          dead_time_flag: "boolean"
          coherence_time_ms: "integer"
          
      "/sensors/air_data":
        schema:
          airspeed: [indicated, calibrated, true_airspeed]
          altitude: [pressure_altitude, density_altitude]
          mach_number: "float"
          angle_of_attack: "degrees"
          
      "/sensors/weather_radar":
        schema:
          reflectivity_dbz: "float_array"
          doppler_velocity: "float_array" 
          spectrum_width: "float_array"
          range_bins: "integer_array"

  # Trajectory Proposals (QS State: α)
  "/traj/proposed":
    description: "4D micro-trajectory proposals with QS state α (proposed)"
    schema_version: "v1.0"
    qs_state: "α"  # proposed state
    horizon_minutes: 10
    
    schema:
      trajectory_id: 
        type: "string"
        format: "utcs_mi_v5"
      
      waypoints:
        type: "array"
        items:
          latitude: "float64"      # degrees
          longitude: "float64"     # degrees
          altitude_ft: "integer"   # feet MSL
          timestamp: "datetime"    # UTC
          
      performance:
        estimated_time: "duration"
        fuel_burn_lbs: "float"
        distance_nm: "float"
        
      optimization_context:
        cost_function_value: "float"
        weather_avoidance_score: "float"
        constraints_satisfied: "boolean"
        confidence_level: "float"  # 0.0 to 1.0
        
      quantum_provenance:
        classical_solution: "boolean"
        quantum_enhanced: "boolean"
        ensemble_scenarios: "integer"
        coherence_metrics: "object"

  # FMS Delta Commands (QS State: β after crew acceptance)  
  "/fms/delta":
    description: "FMS delta commands after crew acceptance, QS state β (loaded)"
    schema_version: "v1.0"
    qs_state: "β"  # loaded state (crew accepted)
    
    schema:
      command_id:
        type: "string"
        format: "utcs_mi_v5"
        
      trajectory_reference:
        type: "string"
        description: "Links to /traj/proposed trajectory_id"
        
      deltas:
        heading_change:
          value: "float"
          units: "degrees"
          relative_to: "current_heading"
        altitude_change:
          value: "integer" 
          units: "feet"
          rate_fpm: "integer"
        speed_change:
          value: "float"
          units: "knots"
          type: "indicated_airspeed"
          
      lateral_offsets:
        type: "array"
        items:
          waypoint_id: "string"
          offset_nm: "float"
          direction: "degrees"
          
      crew_acceptance:
        timestamp: "datetime"
        pilot_id: "string"
        confirmation: "boolean"
        
      safety_bounds:
        max_bank_angle: 25.0
        altitude_limits: [min_fl, max_fl]
        speed_limits: [min_speed, max_speed]

  # Risk Field Data
  "/risk/fields":
    description: "Continuous risk fields for optimization with gradients"
    schema_version: "v1.0"
    continuous_fields: true
    
    schema:
      edr_field:
        type: "gridded_field"
        units: "m^(2/3)/s"
        interpolation: "bilinear"
        gradients_available: true
        
      convective_probability:
        type: "gridded_field"
        units: "probability"
        range: [0.0, 1.0]
        threshold_severe: 0.7
        
      icing_probability:
        type: "gridded_field" 
        units: "probability"
        altitude_layers: "boolean"
        
      turbulence_intensity:
        type: "gridded_field"
        classification: ["light", "moderate", "severe"]
        
      grid_metadata:
        spatial_resolution_km: "float"
        temporal_resolution_min: "integer"
        coverage_bounds: [min_lat, max_lat, min_lon, max_lon]

  # Federation Entanglement (FE)
  "/fe/federation":
    description: "Federation policies and entanglement semantics"
    schema_version: "v1.0"
    federation_aware: true
    
    schema:
      federation_manifest:
        federation_id: "string"
        member_nodes: "array"
        consensus_protocol: "string"
        
      risk_sharing_policies:
        share_edr_data: "boolean"
        share_route_intentions: "boolean"
        conflict_resolution: "consensus"
        
      entanglement_rules:
        cross_domain_visibility: "array"
        data_sovereignty: "object"
        privacy_preserving: "boolean"
        
      orchestration_state:
        active_federations: "array"
        pending_consensus: "array"
        resolved_conflicts: "array"

# Interface Validation Rules
validation_rules:
  
  schema_compliance:
    enforce_versioning: true
    backward_compatibility: "minor_versions"
    breaking_change_notification: "major_versions"
    
  quantum_bridge_validation:
    cb_deterministic: "jitter < 20%"
    qb_fallback_available: "classical_path_preserved"
    ue_continuous_fields: "gradients_computable"
    fe_consensus_reachable: "byzantine_fault_tolerant"
    fwd_prediction_skill: "improvement >= 5%"
    qs_state_transitions: "reversible_with_audit"
    
  security_validation:
    message_signing: "eip712_required"
    replay_protection: "timestamp_nonce_required"
    access_control: "role_based_permissions"
    
  performance_validation:
    real_time_constraints: "300ms_max_latency"
    throughput_requirements: "100Hz_sensor_data"
    reliability: "99.9%_availability"

# Cross-Domain Integration Map  
cross_domain_integration:
  
  AAA: # Aerodynamics
    publishes: ["/perf/drag_thrust_fuel"]
    subscribes: ["/met/tiles", "/traj/proposed"]
    
  CCC: # Cockpit  
    publishes: ["/crew/acceptance", "/fms/delta"]
    subscribes: ["/traj/proposed"]
    
  CQH: # Quantum
    publishes: ["/quantum/enhanced_solutions"] 
    subscribes: ["/optimization/classical_baseline"]
    
  DDD: # Security
    publishes: ["/security/signatures", "/access/policies"]
    subscribes: ["*"]  # monitors all topics
    
  EDI: # Electronics
    publishes: ["/sensors/*"]
    subscribes: ["/calibration/commands"]
    
  EER: # Environment
    publishes: ["/risk/fields", "/met/tiles"]
    subscribes: ["/forecast/requests"]
    
  IIS: # Intelligence
    publishes: ["/ai/predictions", "/ml/models"]
    subscribes: ["/sensors/*", "/met/tiles"]
    
  LCC: # Communications
    publishes: ["/comms/status", "/datalink/*"]
    subscribes: ["*"]  # communication backbone
    
  LIB: # Blockchain
    publishes: ["/blockchain/anchors", "/audit/trails"]
    subscribes: ["/traj/proposed", "/fms/delta"]
    
  OOO: # OS (Primary)
    publishes: ["*"]  # orchestrates all topics
    subscribes: ["*"]  # receives all data streams

# Topic Lifecycle Management
lifecycle:
  topic_creation: "domain_owner_authorized"
  schema_evolution: "backward_compatible_preferred"
  deprecation_policy: "6_month_notice"
  retention_policy: "domain_specific"
  
# Monitoring & Observability  
observability:
  metrics_collection: "prometheus_format"
  distributed_tracing: "opentelemetry"
  logging: "structured_json"
  alerting: "anomaly_detection_enabled"